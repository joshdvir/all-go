pipeline:
  docker:
    image: joshdvir/drone-docker-bash
    repo: joshdvir/all-go
    tag:
      - "${DRONE_BUILD_NUMBER}"
      - "latest"
    force_tag: true
    file: Dockerfile
    secrets: [ docker_username, docker_password ]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  release:
    image: golang:1.10
    secrets: [ github_token ]
    commands:
      curl -sL https://git.io/goreleaser --snapshot | bash